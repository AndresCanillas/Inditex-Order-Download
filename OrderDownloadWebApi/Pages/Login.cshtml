@page
@inject ILocalizationService  g
@inject IAppConfig config
@{
    Layout = null;
    var path = "/";
    if (Request.Query.ContainsKey("path"))
    {
        path = Request.Query["path"];
    }
    bool isqa = config["DownloadServicesWeb.IsQA"] == "true";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Print Entry</title>
    <link rel="stylesheet" href="/css/bootstrap.css" />
    <link rel="stylesheet" href="/css/jquery-ui.min.css" />
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/themify-icons.css">
    <link rel="stylesheet" href="/styles/kendo.common.min.css" />
    <link rel="stylesheet" href="/styles/kendo.default.min.css" />
    <link rel="stylesheet" href="/css/AppContext.css" />
    <script src="~/js/jquery-3.0.0.min.js"></script>
    <script src="~/js/bootstrap.min.js"></script>
    <script src="~/js/AppContext.js"></script>
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-dark" style="top:0px; left:0px; width:100%; height:57px; background-color:#3F454A; color:#ffffff; border-bottom:solid 1px #000000;">
        <div style="white-space:nowrap">
            <img src="~/images/Inditex-Logo2.png" width="140" height="80" />
            @if (isqa)
            {
                <span style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family:Calibri; font-size:7pt; color:white">QA - </span>
            }
            <span style="font-family:Calibri; font-size:7pt; color:white">Dev</span>
        </div>
    </nav>
    <br />
    <div class="container main-panel-content">
        <div class="row">
            <div class="col">&nbsp;</div>
            <div class="col">
                <br />
                <h5 class="login-title">Inditex Orders Download</h5>
                <br />
                <div style="padding:10px; margin:auto; width:80%;">
                    <div class="form-group">
                        <label>@g["User Name"]:</label>
                        <input type="text" name="usr" class="form-control" required autofocus />
                    </div>
                    <br />
                    <div class="form-group">
                        <label>@g["Password"]:</label>
                        <input type="password" name="pwd" class="form-control" required />
                    </div>
                    <br />
                    <input type="button" name="submitButton" value="Login" class="btn btn-primary" />
                </div>
                <br />
            </div>
            <div class="col">&nbsp;</div>
        </div>
    </div>
    <footer style="background-color: #f0f3f5; border-top:solid 1px #bdbdbd;">
        <div class="container-fluid text-center">
            <div class="footer-copyright text-center py-2">

            </div>
        </div>
    </footer>

    <script>
		$(document).ready(() => {
			$("[name='pwd']").on('keypress', commitIfEnter);
			$("[name='submitButton']").on('click', loginClick);
		});

		function commitIfEnter(e) {
			if (e.keyCode === 13) {
				e.preventDefault();
				loginClick();
			}
		}

        function loginClick() {
			let usr = $("[name='usr']").val();
			let pwd = $("[name='pwd']").val();
			var overlay = $('<div><div class="overlay"></div><div class="overlaymessage">@g["Processing..."]</div></div>');
			overlay.appendTo(document.body);
			AppContext.Authenticate(usr, pwd)
				.then((r) => document.location = "@path")
				.catch((err) => {
					AppContext.ShowError("Invalid user or password");
					overlay.remove();
				});
		}
    </script>
</body>
</html>
