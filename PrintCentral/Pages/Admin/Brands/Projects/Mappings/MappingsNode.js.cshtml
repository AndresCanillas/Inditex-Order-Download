@page
@inject ILocalizationService g
@inject IUserData userData
@{
	Layout = null;
}
//# sourceURL=https://Pages/Admin/Brands/Projects/Mappings/MappingsNode.js
/// <reference path="/js/jquery-3.0.0.min.js" />
/// <reference path="/js/Kendo.all.min.js" />
/// <reference path="/js/AppContext.js" />

//<script>
	var MappingsNode = function (id, name) {
		TreeNode.Extend(this, "MappingsNode", id, name);
		this.CanEdit = true;
		this.menu = {
			MenuWidth: "250px",
			Options: [
				{ Text: "@Html.Raw(g["Open"])", OnClick: this.OnDoubleClick }
				@if (userData.Admin_Mappings_CanRename)
				{
				@:, { Text: "@Html.Raw(g["Rename"])", OnClick: this.Rename }
				}
				@if (userData.Admin_Mappings_CanAdd)
				{
				@:, { Text: "@Html.Raw(g["Duplicate"])", OnClick: this.Duplicate }
				}
				@if (userData.Admin_Mappings_CanDelete)
				{
				@:, { IsSeparator: true }
				@:, { Text: "@Html.Raw(g["Delete"])", OnClick: this.Delete }
				}
			]
		};
		this.Expand();
	};

	MappingsNode.prototype = {
		constructor: MappingsNode,

		GetContextMenu: function () {
			return this.menu;
		},


		@if(userData.Admin_Mappings_CanRename)
		{
		<text>
		Rename: function () {
			this.BeginEdit();
		},

		OnEditEnding: function (value) {
			return AppContext.Mappings.Rename(this.EntityID, value);
		},
		</text>
		}

		@if(userData.Admin_Mappings_CanAdd)
		{
		<text>
		Duplicate: async function () {
			var self = this;
			var mappingid = this.EntityID;
			await AppContext.LoadJS("/Common/AskNameDialog.js");
			var dialog = new AskNameDialog("@g["New Mapping"]");
			dialog.ShowDialog(async function (dlgData) {
				if (!dlgData) return;
				var result = await AppContext.Mappings.Duplicate(mappingid, dlgData.Name);
				if (result.Success) {
					var mapping = result.Data;
					self.Parent.AddNode(new MappingsNode(mapping.ID, mapping.Name));
				}
			});
		},

		OnEditEnding: function (value) {
			return AppContext.Mappings.Rename(this.EntityID, value);
		},
		</text>
		}


		@if(userData.Admin_Mappings_CanDelete)
		{
		<text>
		Delete: function () {
			var self = this;
			var confirm = new ConfirmDialog("@g["Delete Mappings? IMPORTANT: Deleting this record may prevent the correct processing of files for this company."]");
			confirm.ShowDialog(function (response) {
				if (response) {
					AppContext.Mappings.Delete(self.EntityID, function (result) {
						if (result.Success)
							self.Remove();
					});
				}
			});
		},
		</text>
		}

		OnDoubleClick: function () {
			var self = this;
			AppContext.LoadJS("/Admin/Brands/Projects/Mappings/MappingsView.js").then(() => {
				var view = new MappingsView(self.EntityID);
				view.NodeID = self.NodeID;
				view.OnSaved.Subscribe(self, function (data) { this.setText(data.Name); });
				view.Show(self.getViewContainer());
			});
		}
	};
//</script>



